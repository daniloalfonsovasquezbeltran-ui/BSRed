<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminal Panguipulli - Horarios de buses</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { background: #0b132b; color: #e0e0e0; font-family: 'Inter', sans-serif; }
        .card { background: #1c2541; border-radius: 18px; }
        .tab { padding: 8px 16px; cursor: pointer; }
        .tab-active { border-bottom: 3px solid #3a86ff; color: #3a86ff; }
        .fade-in { animation: fade .4s ease-in-out; }
        @keyframes fade { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>

<body class="min-h-screen">

<div class="max-w-4xl mx-auto p-4 fade-in">

    <!-- HEADER -->
    <div class="flex items-center gap-3 mb-6">
        <img src="logo_192.png" class="w-14 h-14 rounded-xl border border-gray-700 shadow-lg bg-white"/>
        <div>
            <h1 class="text-2xl font-semibold text-white">Terminal Panguipulli</h1>
            <p class="text-gray-400 text-sm">Horarios de buses en tiempo real</p>
        </div>
    </div>

    <!-- BUSCADOR -->
    <div class="card p-4 mb-5 shadow-xl">
        <input id="buscar" type="search" placeholder="Buscar por destino, origen o empresa..."
               class="w-full p-3 rounded-lg bg-[#0d1b2a] text-gray-200 outline-none">
    </div>

    <!-- TABS -->
    <div class="flex gap-6 text-sm font-medium mb-4">
        <button id="tab-salidas" class="tab tab-active">Salidas</button>
        <button id="tab-llegadas" class="tab">Llegadas</button>
    </div>

    <!-- TABLA -->
    <div class="card p-2 shadow-xl">
        <table class="w-full text-left rounded-lg overflow-hidden">
            <thead class="text-gray-400 border-b border-gray-600">
                <tr>
                    <th class="p-3">Hora salida</th>
                    <th class="p-3">Empresa</th>
                    <th class="p-3">Destino</th>
                    <th class="p-3">Llegada</th>
                </tr>
            </thead>
            <tbody id="tbody" class="fade-in"></tbody>
        </table>
    </div>

    <p id="error-msg" class="text-center text-red-400 mt-4"></p>

</div>

<!-- ========================================================= -->
<!-- âœ… SCRIPT PARA CONECTAR A LA API DE RENDER Y ACTUALIZAR TABLA -->
<!-- ========================================================= -->

<script>
const api = "https://bsred.onrender.com/horarios";   // URL FIJA PARA EVITAR 404
let horarios = [];
let vista = "salidas"; // por defecto

document.getElementById("buscar").addEventListener("input", filtrar);
document.getElementById("tab-salidas").addEventListener("click", () => cambiarVista("salidas"));
document.getElementById("tab-llegadas").addEventListener("click", () => cambiarVista("llegadas"));

// Cargar horarios desde API
cargarHorarios();

async function cargarHorarios() {
    try {
        const res = await fetch(api);
        if (!res.ok) throw new Error("HTTP " + res.status);

        horarios = await res.json();
        filtrar();

    } catch (error) {
        document.getElementById("error-msg").innerText =
            "Error al cargar horarios: " + error.message;
    }
}

function cambiarVista(tab) {
    vista = tab;
    document.getElementById("tab-salidas").classList.toggle("tab-active", tab === "salidas");
    document.getElementById("tab-llegadas").classList.toggle("tab-active", tab === "llegadas");
    filtrar();
}

function filtrar() {
    const q = document.getElementById("buscar").value.toLowerCase();

    let filtrados = horarios.filter(h => {
        const cumple = h.destino.toLowerCase().includes(q)
                    || h.empresa.toLowerCase().includes(q)
                    || h.salida.toLowerCase().includes(q);

        if (!cumple) return false;
        if (vista === "salidas") return !h.destino.includes("Panguipulli");
        if (vista === "llegadas") return h.destino.includes("Panguipulli");
    });

    renderTabla(filtrados);
}

function renderTabla(lista) {
    const tbody = document.getElementById("tbody");
    tbody.innerHTML = "";

    if (lista.length === 0) {
        tbody.innerHTML = `<tr><td colspan="4" class="text-center py-4 text-gray-400">Sin resultados</td></tr>`;
        return;
    }

    lista.forEach(h => {
        tbody.innerHTML += `
        <tr class="border-b border-gray-700 hover:bg-[#243b55] transition">
            <td class="p-3 font-semibold text-blue-300">${h.salida}</td>
            <td class="p-3">${h.empresa}</td>
            <td class="p-3">${h.destino}</td>
            <td class="p-3">${h.llegada}</td>
        </tr>
        `;
    });
}
</script>

</body>
</html>
